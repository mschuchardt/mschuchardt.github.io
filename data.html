<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Electronic Health Record Interoperability</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/yeti.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 45px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h2 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h3 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h4 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h5 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h6 {
  padding-top: 50px;
  margin-top: -50px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Matt Schuchardt</a>
</li>
<li>
  <a href="demo.html">Modeling</a>
</li>
<li>
  <a href="data.html">Visualization</a>
</li>
<li>
  <a href="match.html">Matching</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://www.linkedin.com/in/mattschuchardt/">
    <span class="fa fa-linkedin"></span>
     
  </a>
</li>
<li>
  <a href="mailto:matt@schu.in">
    <span class="fa fa-envelope"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Electronic Health Record Interoperability</h1>

</div>


<pre class="r"><code># meaningful use reports ----
# cms api url
url.mu &lt;- paste0(&quot;http://dashboard.healthit.gov/datadashboard/&quot;,
                 &quot;data/MU_REPORT.csv&quot;)

# read Meaningful Use report direct from CMS
mu &lt;- fread(url.mu)

# total attestations
total.attest &lt;- nrow(mu)

# create attestation date from date components
mu[, attested := lubridate::make_date(
  as.numeric(Attestation_Year),
  as.numeric(Attestation_Month),
  1L)]

# clean character variables
mu[, Vendor_Name := str_conv(Vendor_Name, &quot;latin1&quot;)]
mu[, EHR_Product_Name := str_conv(EHR_Product_Name, &quot;latin1&quot;)]
mu[, CCN := ifelse(nchar(CCN) == 5,
                      paste0(&quot;0&quot;, CCN),
                      as.character(CCN))]
mu[, Id := ifelse(is.na(CCN), NPI, CCN)]

# records per attestation
npi.attest &lt;- mu[, 
                 .N,
                 by = .(Id, Attestation_Month, Attestation_Year)]

# vendors per attestation
npi.vend &lt;- mu[,
               length(unique(Vendor_Name)),
               by = .(Id, 
                      Program_Year,
                      Product_Classification, 
                      attested)] 

# number of attestations per Id
npi.year &lt;- mu[, .(min(Attestation_Year),
                   max(Attestation_Year)), 
               keyby = Id
               ][, Years := V2 - V1]

# number of vendors per modular attestation
mod.attest &lt;- npi.attest[npi.vend[Product_Classification ==
                                    &quot;Modular EHR&quot;, .(Id)],
                         on = &quot;Id&quot;][,
                                    Vendors := 
                                      case_when(N == 1 ~ &quot;One&quot;,
                                                N == 2 ~ &quot;Two&quot;,
                                                N == 3 ~ &quot;Three&quot;,
                                                N == 4 ~ &quot;Four&quot;,
                                                N == 5 ~ &quot;Five&quot;,
                                                TRUE ~ &quot;Six or More&quot;)
                                    ][, Vendors := 
                                        factor(Vendors,
                                               levels =
                                                 c(&quot;One&quot;,
                                                   &quot;Two&quot;,
                                                   &quot;Three&quot;,
                                                   &quot;Four&quot;,
                                                   &quot;Five&quot;,
                                                   &quot;Six or More&quot;),
                                               ordered = T)]

# fill in gaps in attestation year
expand_yr &lt;- function(x){
  out &lt;- as.numeric(seq(min(x), max(x), 1))
}

# get range of attestation years per vendor
# fill gaps
vendor.yrs &lt;- mu[,
                 .(expand_yr(Attestation_Year),
                  .N),
                 keyby = .(Id,
                           Vendor_Name,
                           Product_Classification,
                           Provider_Type)]

setnames(vendor.yrs, &quot;V1&quot;, &quot;Attestation_Year&quot;)
# prep vendor names for plotting
vendor.yrs[, Vendor_Name := 
           case_when(str_detect(Vendor_Name, 
                                &quot;MEDITECH&quot;) ~ &quot;MEDITECH&quot;,
                               str_detect(Vendor_Name,
                                          &quot;CPSI|Evident&quot;) ~ &quot;CPSI&quot;,
                               str_detect(Vendor_Name,
                  &quot;Healthcare Management Sys|HMS&quot;) ~ 
                    &quot;MEDHOST&quot;,
                               str_detect(Vendor_Name,
                                          &quot;HCA&quot;) ~ &quot;HCA&quot;,
                               str_detect(Vendor_Name,
                                          &quot;McKesson&quot;) ~ &quot;Allscripts&quot;,
                               str_detect(Vendor_Name,
                                          &quot;Siemens&quot;) ~ &quot;Cerner&quot;,
                               TRUE ~ 
                                 str_remove_all(Vendor_Name,
                                          &quot; Corporation|, LLC&quot;))]
 
# attestations by vendor
vendor &lt;- vendor.yrs[, length(unique(Id)),
                     keyby = .(Vendor_Name,
                               Attestation_Year,
                               Provider_Type)]

# top vendors by attestation
# use to limit vendors for plotting
top.vendors &lt;- vendor[, Installs := max(V1),
                      keyby = .(Vendor_Name, Provider_Type)
                      ][, .(dense_rank(desc(Installs)),
                            Installs,
                            Vendor_Name),
                        keyby = Provider_Type]
 
top.vendors[, Vendor := 
              ifelse(Provider_Type == &quot;Hospital&quot; &amp; V1 &lt; 6 |
                           Provider_Type == &quot;EP&quot; &amp; V1 &lt;= 8,
                         Vendor_Name, &quot;Other&quot;)]</code></pre>
<pre class="r"><code># hospital affiliations ----
# Get Physician Compare data via API call to CMS
# will read in all variables as character as CCN5 screws up 
# vartype hueristics
cls &lt;- rep(&quot;character&quot;, 41)

# call data directly from CMS
aff.hosp &lt;- fread(&quot;https://data.medicare.gov/api/views/mj5m-pzi6/rows.csv?accessType=DOWNLOAD&quot;, colClasses = cls)

total.docs &lt;- nrow(aff.hosp)

# affiliated column names
ccn &lt;- paste(&quot;Hospital affiliation CCN&quot;, 1:5)
lbn &lt;- paste(&quot;Hospital affiliation LBN&quot;, 1:5)

# variables of interest
# limiting identifing variables to Ids
Vars &lt;- c(&quot;NPI&quot;,
          ccn,
          lbn)

# limit to target variables
aff.hosp &lt;- aff.hosp[, Vars, with = FALSE]

# prepare NPI for matching
aff.hosp &lt;- aff.hosp[, NPI := as.integer(NPI)]

# limit to unique NPI
aff.hosp &lt;- unique(aff.hosp, by = Vars)

# reshape data----
# melt is the equivalent of gather/pivot
aff.hosp &lt;- melt(aff.hosp, measure = patterns(&quot;CCN&quot;,
                                              &quot;LBN&quot;),
                 value.name = c(&quot;MedicareNumber&quot;,
                                &quot;Hospital&quot;))
aff.hosp[,variable := NULL]

# limit to providers reporting affiliations
aff.hosp &lt;- aff.hosp[MedicareNumber != &quot;&quot;,]</code></pre>
<div id="section" class="section level1 tabset">
<h1></h1>
<p><a href="https://www.himss.org/library/interoperability-standards/what-is-interoperability">Interoperability is the ability of different information systems, devices or applications to connect, in a coordinated manner, within and across organizational boundaries to access, exchange and cooperatively use data amongst stakeholders, with the goal of optimizing the health of individuals and populations.</a></p>
<p>Looking at the number of systems that must coordinate to achieve interoperability between a single hospital and it’s affiliated physicians illustrates the magnitude of the effort required to achieve interoperability on a national level.</p>
<pre class="r"><code># affiliations with mu records
aff.hosp2 &lt;- aff.hosp[NPI %in% mu$NPI &amp;
           MedicareNumber %in% mu[!is.na(mu$CCN),]$CCN]

# unique
aff.hosp2 &lt;- unique(aff.hosp2)

setkeyv(aff.hosp2, c(&quot;NPI&quot;, &quot;MedicareNumber&quot;))

# ep vendors
mu.ep &lt;- mu[Provider_Type == &quot;EP&quot; &amp;
              NPI %in% aff.hosp2$NPI, .(NPI, Vendor_Name)]

mu.ep &lt;- unique(mu.ep)
  
setkey(mu.ep, NPI)

# hosp vendors
mu.hosp &lt;- mu[Provider_Type == &quot;Hospital&quot; &amp;
                CCN %in% aff.hosp2$MedicareNumber, 
              .(CCN, Vendor_Name)]

mu.hosp &lt;- unique(mu.hosp)

setnames(mu.hosp, c(&quot;MedicareNumber&quot;, 
                    &quot;Vendor_Name&quot;))

setkey(mu.hosp, MedicareNumber)

# joins
mu.aff &lt;- aff.hosp2[mu.ep,
                    .(MedicareNumber, Vendor_Name),
                    by = .EACHI]

setkey(mu.aff, MedicareNumber)

mu.aff &lt;- mu.aff[mu.hosp,
               allow.cartesian = T]

mu.aff &lt;- unique(mu.aff)

mu.aff[, Same := i.Vendor_Name == Vendor_Name]

mu.same &lt;- unique(mu.aff[, .(NPI, MedicareNumber, Same)])

aff.cnt &lt;- aff.hosp[,
                    .(length(unique(MedicareNumber))),
                    keyby = NPI]

hosp.cnt &lt;- aff.hosp[,
                    .(length(unique(NPI))),
                    keyby = MedicareNumber]


aff.mu.avg &lt;-  mu.aff[,
                     .(length(unique(Vendor_Name)),
                       length(unique(NPI)),
                       mean(Same)),
                       keyby = &quot;MedicareNumber&quot;]

setnames(aff.mu.avg, c(&quot;MedicareNumber&quot;, 
                       &quot;Vendors&quot;,
                       &quot;Affiliated&quot;, 
                       &quot;InterOp&quot;))

aff.mu.npi &lt;- mu.aff[,
                     .(max(as.numeric(Same)) == 0),
                     keyby = .(NPI, MedicareNumber)
                     ] 

aff.mu.npi.cnt &lt;- aff.mu.npi[,
                             .(length(unique(MedicareNumber)),
                               sum(V1)),
                             keyby = NPI] 

setnames(aff.mu.npi.cnt, c(&quot;NPI&quot;, 
                           &quot;Affiliated&quot;, 
                           &quot;Vendors&quot;))</code></pre>
<p>Since April 2011 235,806 providers reported their EHR vendor and affiliation with at least one of 4,381 hospitals.</p>
<div id="hospitals" class="section level2">
<h2>Hospitals</h2>
<p>Hospitals have to coordinate with an additional EHR system for every 3 affiliated physicians.</p>
<pre class="r"><code>aff.mu.avg %&gt;% 
  mutate(grp = &quot;group&quot;) %&gt;% 
  ggplot(aes(Affiliated, Vendors))+
  geom_jitter(shape = &quot;.&quot;,
              alpha = 3/4)+
  geom_smooth(aes(color = grp),
              show.legend = F,
              size = 1.25,
              span = 1)+
  scale_y_continuous(limits = c(1, 50))+
  scale_x_log10(limits = c(1, 1000))+
  scale_color_viridis_d(begin = 0.0,
                       end = 0.1)+
  labs(title = paste(&quot;Affiliated physicians use&quot;,
                     round(mean(aff.mu.avg$Vendors)),
                    &quot;disparate EHR systems on average&quot;),
       x = &quot;log10(Affiliated Physicians)&quot;,
       y = &quot;Physician EHR Vendors&quot;)+
  theme(panel.background =
          element_rect(fill = &quot;white&quot;,
                       colour = &quot;grey50&quot;))</code></pre>
<p><img src="data_files/figure-html/sct-1.png" width="576" /></p>
</div>
<div id="providers" class="section level2 tabset tabset-pills">
<h2>Providers</h2>
<p>68% of physician affiliations involve multiple EHR vendors.</p>
<div id="single-affiliation" class="section level3">
<h3>Single Affiliation</h3>
<pre class="r"><code>aff.mu.npi.cnt %&gt;% 
  filter(Affiliated == 1) %&gt;% 
  mutate(Same = Vendors == 0) %&gt;%
  group_by(Same) %&gt;% 
  summarize(n = n()) %&gt;% 
  ungroup() %&gt;% 
  mutate(label = paste0(round(n / sum(n), 2)*100, &quot;%&quot;)) %&gt;% 
  ggplot(aes(Same, n))+
  geom_col(aes(fill = Same), show.legend = F)+
  geom_text(aes(label = label,
                color = Same),
            nudge_y = -5000,
            fontface = &quot;bold&quot;,
            size = 5,
            show.legend = F)+
  scale_fill_viridis_d(option = &quot;D&quot;,
                       begin = 0.4,
                       end = 0.8)+
  scale_color_viridis_d(direction = -1,
                        option = &quot;D&quot;,
                        begin = 0.4,
                       end = 0.8)+
  scale_y_continuous(labels = scales::comma)+
  labs(title = 
         paste(comma(nrow(aff.mu.npi.cnt[aff.mu.npi.cnt$Affiliated ==
                                       1,])),
       &quot;Physicians reporting a single affiliation&quot;),
       y = &quot;Physicians&quot;,
       x = &quot;Reported Use of same EHR as Affiliated Hospital&quot;)+
  theme(panel.background =
          element_rect(fill = &quot;white&quot;,
                       colour = &quot;grey50&quot;))</code></pre>
<p><img src="data_files/figure-html/physplots-1.png" width="576" /></p>
</div>
<div id="multiple-affiliations" class="section level3">
<h3>Multiple Affiliations</h3>
<pre class="r"><code>aff.mu.npi.cnt %&gt;% 
  filter(Affiliated &gt; 1) %&gt;% 
  mutate(Same = Vendors == 0) %&gt;%
  select(NPI, Same) %&gt;% 
  unique() %&gt;% 
  group_by(Same) %&gt;% 
  summarize(n = n()) %&gt;% 
  ungroup() %&gt;% 
  mutate(label = paste0(round(n / sum(n), 2)*100, &quot;%&quot;)) %&gt;% 
  ggplot(aes(Same, n))+
  geom_col(aes(fill = Same), show.legend = F)+
  geom_text(aes(label = label,
                color = Same),
            nudge_y = -5000,
            fontface = &quot;bold&quot;,
            size = 5,
            show.legend = F)+
   scale_fill_viridis_d(begin = 0.4,
                       end = 0.8)+
  scale_color_viridis_d(direction = -1,
                        begin = 0.4,
                       end = 0.8)+
 scale_y_continuous(labels = scales::comma)+
  labs(title = 
         paste(comma(nrow(aff.mu.npi.cnt[aff.mu.npi.cnt$Affiliated !=
                                       1,])),
       &quot;Physicians reporting multiple affiliations&quot;),
       y = &quot;Physicians&quot;,
       x = paste0(&quot;Reported Use of same EHR &quot;,
                  &quot;as at least 1 Affiliated Hospital&quot;))+
  theme(panel.background =
          element_rect(fill = &quot;white&quot;,
                       colour = &quot;grey50&quot;))</code></pre>
<p><img src="data_files/figure-html/mutaff-1.png" width="576" /></p>
</div>
</div>
<div id="additional-ehrs" class="section level2">
<h2>Additional EHRs</h2>
<pre class="r"><code>aff.mu.npi.cnt %&gt;% 
  mutate(grp = &quot;group&quot;) %&gt;% 
  ggplot(aes(Affiliated, Vendors)) +
  stat_summary(fun.data = &quot;median_hilow&quot;,
               geom = &quot;linerange&quot;,
               mapping = aes(color = Affiliated),
               show.legend = F)+
  stat_summary(fun.y = &quot;median&quot;,
               geom = &quot;line&quot;,
               mapping = aes(color = Affiliated),
               show.legend = F)+
  stat_sum(geom = &quot;point&quot;,
           mapping = aes(color = Affiliated),
           show.legend = F)+
  scale_color_viridis_c(begin = 0.2,
                       end = 0.8)+
  scale_y_continuous(labels = scales::comma)+
  scale_x_continuous(labels = scales::comma)+
  labs(title = 
         paste0(comma(nrow(aff.mu.npi.cnt[Affiliated &gt; 1 &amp;
                                            Vendors &gt; 0])),
                &quot; Physicians affiliated with multiple hospitals&quot;,
                &quot;\nhave to interact with multiple EHRs&quot;),
       x = &quot;Hospital Affiliations&quot;,
       y = &quot;Additional EHR Vendors&quot;) +
 theme(panel.background =
          element_rect(fill = &quot;white&quot;,
                       colour = &quot;grey50&quot;))</code></pre>
<p><img src="data_files/figure-html/dispplot-1.png" width="576" /></p>
</div>
<div id="by-hospital-vendor" class="section level2">
<h2>By Hospital Vendor</h2>
<pre class="r"><code>mu.vend &lt;- mu.aff[, .(length(unique(NPI)),
                      length(unique(Vendor_Name))),
           keyby = .(MedicareNumber, i.Vendor_Name)
           ]

mu.vend &lt;- mu.vend[mu[, .I[attested == max(attested)],
           by = .(CCN, Vendor_Name)]$V1]

mu.vend &lt;- unique(mu.vend)

setnames(mu.vend, c(&quot;MedicareNumber&quot;, 
                    &quot;Vendor_Name&quot;,
                    &quot;Affiliated&quot;,
                    &quot;Vendors&quot;))

mu.vend$Vendor &lt;- case_when(str_detect(mu.vend$Vendor_Name, 
                                &quot;MEDITECH&quot;) ~ &quot;MEDITECH&quot;,
                               str_detect(mu.vend$Vendor_Name,
                                          &quot;CPSI|Evident&quot;) ~ &quot;CPSI&quot;,
                               str_detect(mu.vend$Vendor_Name,
                  &quot;Healthcare Management Sys|HMS&quot;) ~ 
                    &quot;MEDHOST&quot;,
                               str_detect(mu.vend$Vendor_Name,
                                          &quot;HCA&quot;) ~ &quot;HCA&quot;,
                               str_detect(mu.vend$Vendor_Name,
                                          &quot;McKesson&quot;) ~ &quot;Allscripts&quot;,
                               str_detect(mu.vend$Vendor_Name,
                                          &quot;Siemens|Cerner&quot;) ~ &quot;Cerner&quot;,
                               TRUE ~ 
                                 str_remove_all(mu.vend$Vendor_Name,
                                          &quot; Corporation|, LLC&quot;))

mu.vend &lt;- mu.vend[Vendor %in%
                     top.vendors[top.vendors$Provider_Type ==
                                   &quot;Hospital&quot;, ]$Vendor] 

mu.vend %&gt;% 
  ggplot(aes(Affiliated, Vendors))+
  geom_jitter(shape = &quot;.&quot;, alpha = 2/3)+
  geom_smooth(aes(color = Vendor), 
              fullrange = T,
              se = F)+
  scale_x_log10()+
  scale_color_viridis_d()+
  guides(color = guide_legend(title = &quot;Hospital\nVendor&quot;))+
  labs(title = &quot;Hospital Vendor Impact&quot;,
       x = &quot;log10(Affiliated Physicians)&quot;,
       y = &quot;Physician EHR Vendors&quot;)+
  theme(panel.background =
          element_rect(fill = &quot;white&quot;,
                       colour = &quot;grey50&quot;),
        legend.key.size = unit(2, &quot;lines&quot;))</code></pre>
<p><img src="data_files/figure-html/byvend-1.png" width="576" /></p>
</div>
</div>
<div id="vendor-market-share" class="section level1 tabset tabset-pills">
<h1>Vendor Market Share</h1>
<div id="inpatient" class="section level2">
<h2>Inpatient</h2>
<pre class="r"><code>n.hosp &lt;- sum(
    vendor[vendor$Vendor_Name %in%
              top.vendors[top.vendors$Provider_Type ==
                            &quot;Hospital&quot; &amp;
                          top.vendors$Vendor != &quot;Other&quot;,
                          ]$Vendor_Name &amp;
              vendor$Provider_Type == &quot;Hospital&quot; &amp;
             vendor$Attestation_Year == 2017, ]$V1)

n.ep &lt;- sum(vendor[vendor$Vendor_Name %in%
                   top.vendors[top.vendors$Provider_Type !=
                                &quot;Hospital&quot; &amp;
                          top.vendors$Vendor != &quot;Other&quot;,
                          ]$Vendor_Name &amp;
              vendor$Provider_Type != &quot;Hospital&quot; &amp;
             vendor$Attestation_Year == 2017, ]$V1)

vendor %&gt;% 
  inner_join(top.vendors %&gt;% 
               filter(Vendor != &quot;Other&quot;) %&gt;% 
               select(Vendor_Name, Provider_Type, Vendor)) %&gt;% 
  filter(Provider_Type != &quot;EP&quot;) %&gt;% 
  filter(Attestation_Year &lt; 2018) %&gt;% 
  ggplot(aes(Attestation_Year, V1))+
  geom_smooth(aes(group = Vendor,
                color = fct_reorder2(Vendor,
                                     Attestation_Year,
                                     V1)),
              span = T,
              size = 1.3,
              se = F)+
  scale_y_continuous(labels = scales::comma)+
  guides(color = guide_legend(title = NULL))+
  labs(title = &quot;Hospital Attestations&quot;,
       x = &quot;Attestation Year&quot;,
       y = &quot;Hospitals&quot;,
       caption = paste0(&quot;n = &quot;, comma(n.hosp)))+
  scale_color_viridis_d()+
  scale_y_continuous(labels = scales::comma)+
  theme(panel.background =
          element_rect(fill = &quot;white&quot;,
                       colour = &quot;grey50&quot;),
        legend.key.size = unit(2, &quot;lines&quot;))</code></pre>
<p><img src="data_files/figure-html/inpplot-1.png" width="576" /></p>
</div>
<div id="outpatient" class="section level2">
<h2>Outpatient</h2>
<pre class="r"><code>vendor %&gt;% 
  inner_join(top.vendors %&gt;% 
               filter(Vendor != &quot;Other&quot;) %&gt;% 
               select(Vendor_Name, Provider_Type, Vendor)) %&gt;% 
  filter(Provider_Type == &quot;EP&quot;) %&gt;% 
  filter(Attestation_Year &lt; 2018) %&gt;% 
  ggplot(aes(Attestation_Year, V1))+
  geom_smooth(aes(group = Vendor,
                color = fct_reorder2(Vendor,
                                     Attestation_Year,
                                     V1)),
              span = 1,
              size = 1.3,
              se = F)+
  scale_y_continuous(labels = scales::comma)+
  guides(color = guide_legend(title = NULL))+
  labs(title = &quot;Eligible Provider Attestations&quot;,
       x = &quot;Attestation Year&quot;,
       y = &quot;Eligible Providers&quot;,
       caption = paste0(&quot;n = &quot;, comma(n.ep)))+
  scale_color_viridis_d()+
  scale_y_continuous(labels = scales::comma)+
  theme(panel.background =
          element_rect(fill = &quot;white&quot;,
                       colour = &quot;grey50&quot;),
        legend.key.size = unit(2, &quot;lines&quot;))</code></pre>
<p><img src="data_files/figure-html/opplot-1.png" width="576" /></p>
</div>
</div>
<div id="data" class="section level1">
<h1>Data</h1>
<p>Two publicly available data sets from the Centers for Medicare and Medicaid Services:<br />
1. <a href="https://dashboard.healthit.gov/datadashboard/documentation/ehr-products-mu-attestation-data-documentation.php">EHR Products Used for Meaningful Use Attestation</a><br />
2. <a href="https://data.medicare.gov/Physician-Compare/Physician-Compare-National-Downloadable-File/mj5m-pzi6">Physician Compare National Downloadable File</a></p>
<div id="meaningful-use-report" class="section level2 tabset">
<h2>Meaningful Use Report</h2>
<p>356,996 Eligible Providers and 4,674 Hospitals made 1,189,492 attestations to the meaningful use of Electronic Health Records from 2011 to 2018. Just over half (59%) of providers attested for 3 or more years.</p>
<div id="attestations" class="section level3">
<h3>Attestations</h3>
<pre class="r"><code>npi.attest %&gt;% 
  filter(Attestation_Year &lt; 2018) %&gt;% 
  ggplot(aes(factor(Attestation_Year)))+
  geom_bar(aes(fill = Attestation_Year),
           width = 1,
           color = &quot;#FFFFFF&quot;)+
  labs(title = &quot;Attestations by Year&quot;,
       x = NULL,
       y = NULL)+
  guides(fill = &quot;none&quot;)+
  scale_fill_viridis_c()+
  scale_y_continuous(labels = scales::comma)+
  theme(panel.background =
          element_rect(fill = &quot;white&quot;,
                       colour = &quot;grey50&quot;))

npi.vend %&gt;% 
  mutate(Product_Classification =
           ifelse(Product_Classification == &quot;&quot;, &quot;Not Reported&quot;,
                  Product_Classification)) %&gt;% 
  ggplot(aes(x = factor(1), fill = Product_Classification))+
  geom_bar(width = 1,
           color = &quot;#FFFFFF&quot;)+
  labs(title = &quot;Product Classification&quot;,
       x = NULL,
       y = NULL)+
  coord_polar(theta = &quot;y&quot;, direction = -1)+
  guides(fill = guide_legend(title = NULL))+
  scale_fill_viridis_d()+
  theme_void()</code></pre>
<p><img src="data_files/figure-html/muplots-1.png" width="45%" /><img src="data_files/figure-html/muplots-2.png" width="45%" /></p>
</div>
<div id="atypical-attestations" class="section level3">
<h3>Atypical Attestations</h3>
<pre class="r"><code>ggplot(mod.attest,
       aes(x = factor(1), 
           fill = Vendors))+
  geom_bar(width = 1,
           color = &quot;#FFFFFF&quot;)+
  labs(title = &quot;Number of Vendors per Modular EHR attestation&quot;,
       subtitle = paste0(round(nrow(mod.attest[N &gt; 3]) /
                                 nrow(mod.attest), 2) *100,
                               &quot;% have 4 or more vendors&quot;),
       x = NULL,
       y = NULL)+
  coord_polar(theta = &quot;y&quot;, direction = -1)+
  theme_void()
  
atypical &lt;- round(nrow(npi.vend[V1 &gt; 1 &amp; 
          Product_Classification == &quot;Complete EHR&quot;]) /
            nrow(npi.vend[Product_Classification == 
                            &quot;Complete EHR&quot;]), 2)*100

npi.vend[V1 &gt; 1 &amp; 
          Product_Classification == &quot;Complete EHR&quot; , ] %&gt;%
  ggplot(aes(V1))+
  geom_bar(aes(fill = Product_Classification), show.legend = F)+
  labs(title = paste0(atypical,
                      &quot;% of Complete EHR attestations have&quot;,
                      &quot; multiple vendors&quot;),
       subtitle = &quot;Complete EHR with 2+ vendors&quot;,
         x = &quot;EHR Vendors&quot;,
         y = &quot;Attestations&quot;)+
  scale_fill_viridis_d()+
  scale_y_continuous(labels = scales::comma)+
  scale_x_continuous(labels = as.integer)+
  coord_cartesian(xlim = c(1, 6))+
  theme(panel.background =
          element_rect(fill = &quot;white&quot;,
                       colour = &quot;grey50&quot;))</code></pre>
<p><img src="data_files/figure-html/atyp-1.png" width="45%" /><img src="data_files/figure-html/atyp-2.png" width="45%" /></p>
</div>
</div>
<div id="physician-compare" class="section level2 tabset">
<h2>Physician Compare</h2>
<p>The physician compare data contains 2,033,311 records. 648,050 Providers reported affiliations with 4,735 hospitals to CMS.</p>
<div id="hospitals-1" class="section level3">
<h3>Hospitals</h3>
<pre class="r"><code>hosp.cnt %&gt;% 
  mutate(grp = &quot;group&quot;) %&gt;% 
  ggplot(aes(V1))+
  geom_histogram(aes(fill = grp),
                 show.legend = F,
                 color = &quot;#FFFFFF&quot;)+
  scale_fill_viridis_d(begin = 0.6,
                       end = 0.7)+
  scale_y_continuous(labels = scales::comma)+
  scale_x_continuous(labels = scales::comma)+
  labs(title = &quot;Number of Affiliated Physicians&quot;,
       y = &quot;Hospital&quot;,
       x = &quot;Affiliated Physicians&quot;)+
  theme(panel.background =
          element_rect(fill = &quot;white&quot;,
                       colour = &quot;grey50&quot;))</code></pre>
<p><img src="data_files/figure-html/haplot-1.png" width="576" /></p>
</div>
<div id="physician-affiliations" class="section level3">
<h3>Physician Affiliations</h3>
<pre class="r"><code>aff.cnt %&gt;% 
  group_by(V1) %&gt;% 
  summarise(n = n()) %&gt;% 
  ggplot(aes(V1, n))+
  geom_col(aes(fill = n), 
           color = &quot;#FFFFFF&quot;,
           width = 1, show.legend = F)+
  scale_fill_viridis_c(begin = 0.2,
                       end = 0.8)+
  scale_y_continuous(labels = scales::comma)+
  labs(title = &quot;Number of Hospital Affiliations&quot;,
       y = &quot;Physicians&quot;,
       x = &quot;Hospital Affiliations&quot;)+
  theme(panel.background =
          element_rect(fill = &quot;white&quot;,
                       colour = &quot;grey50&quot;))</code></pre>
<p><img src="data_files/figure-html/paplot-1.png" width="576" /></p>
</div>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
